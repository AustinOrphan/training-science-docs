<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Science Documentation</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        #docs {
            height: 100vh;
        }
    </style>
    
    <!-- Dependencies for UMD build -->
    <script src="https://cdn.jsdelivr.net/npm/marked@14.1.2/lib/marked.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.1.4/lib/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/lib/highlight.min.js"></script>
</head>
<body>
    <div id="docs"></div>
    
    <script>
        // Track script loading
        let depsLoaded = 0;
        
        function dependencyLoaded() {
            depsLoaded++;
            if (depsLoaded === 3) {
                // All dependencies ready, load viewer
                loadViewer();
            }
        }
        
        function loadViewer() {
            const script = document.createElement('script');
            script.src = './viewer/dist/index.umd.cjs';
            script.onload = function() {
                // Clear any stale theme data
                localStorage.removeItem('training-docs-theme');
                localStorage.removeItem('mdv-theme');
                localStorage.removeItem('mdv-selected-theme');
                
                // Initialize viewer
                initializeViewer();
            };
            script.onerror = function() {
                console.error('Failed to load viewer/dist/index.umd.cjs');
            };
            document.head.appendChild(script);
        }
        
        function initializeViewer() {
            // Ensure hljs is available globally
            if (typeof hljs !== 'undefined') {
                window.hljs = hljs;
            }
            
            const { createViewer, themes } = MarkdownDocsViewer;

        // Configuration for the training science documentation
        const viewer = createViewer({
            container: '#docs',
            title: 'Training Science Documentation',
            theme: {
                name: 'default',
                switcherPosition: 'header',
                darkTogglePosition: 'header',
                showPreview: true,
                showDescription: false,
                allowCustomThemes: false,
                enablePersistence: true,
                storageKey: 'training-docs-theme'
            },
            source: {
                type: 'local',
                basePath: '.',
                documents: [
                    // Introduction
                    {
                        id: 'overview',
                        title: 'Project Overview',
                        file: 'README.md',
                        category: 'Introduction',
                        description: 'Project overview and usage instructions',
                        order: 1
                    },
                    {
                        id: 'disclaimer',
                        title: 'AI-Assisted Documentation Disclaimer',
                        file: 'ai-disclaimer.md',
                        category: 'Introduction',
                        description: 'Important information about AI assistance and validation',
                        order: 2
                    },
                    // Core Documents
                    {
                        id: 'whitepaper',
                        title: 'Training System Whitepaper',
                        file: 'training-system-whitepaper.md',
                        category: 'Core Documents',
                        description: 'Academic-style overview of the complete system',
                        order: 1
                    },
                    {
                        id: 'references',
                        title: 'Scientific References',
                        file: 'training-science-references.md',
                        category: 'Core Documents',
                        description: 'Organized research sources by topic',
                        order: 2
                    },
                    {
                        id: 'implementation',
                        title: 'Implementation Guide',
                        file: 'training-implementation-guide.md',
                        category: 'Core Documents',
                        description: 'Science-to-code mapping and technical details',
                        order: 3
                    },
                    {
                        id: 'calculations',
                        title: 'Calculations Reference',
                        file: 'training-calculations-reference.md',
                        category: 'Core Documents',
                        description: 'Developer-friendly formulas and algorithms',
                        order: 4
                    },
                    {
                        id: 'bibliography',
                        title: 'Complete Bibliography',
                        file: 'training-bibliography.md',
                        category: 'Core Documents',
                        description: 'Full list of 40+ sources and citations',
                        order: 5
                    }
                ]
            },
            navigation: {
                showCategories: true,
                collapsible: true,
                showDescription: true,
                sortBy: 'order'
            },
            search: {
                enabled: true,
                placeholder: 'Search training science docs...',
                searchInTags: true,
                maxResults: 10
            },
            render: {
                syntaxHighlighting: true,
                highlightTheme: 'github',
                copyCodeButton: true,
                linkTarget: '_blank'
            },
            // Mobile configuration
            responsive: true,
            mobile: {
                enabled: true,
                navigation: {
                    swipeGestures: true,
                    collapseBehavior: 'overlay',
                    showBackdrop: true,
                    closeOnOutsideClick: true
                },
                gestures: {
                    swipeToNavigate: true,
                    swipeThreshold: 50
                },
                typography: {
                    baseFontSize: {
                        xs: 14,
                        sm: 15,
                        md: 16
                    }
                }
            }
        });
        
        console.log('Viewer initialized successfully');
        }
        
        // Monitor dependency loading
        const scripts = document.querySelectorAll('script[src]');
        scripts.forEach(script => {
            if (script.src.includes('marked') || script.src.includes('highlight')) {
                script.addEventListener('load', dependencyLoaded);
                script.addEventListener('error', () => {
                    console.error('Failed to load dependency:', script.src);
                });
            }
        });
        
        // Fallback if scripts already loaded
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (
                    typeof marked !== 'undefined' &&
                    typeof hljs !== 'undefined' &&
                    typeof markedHighlight !== 'undefined'
                ) {
                    if (depsLoaded < 3) {
                        loadViewer();
                    }
                }
            }, 100);
        });
    </script>
</body>
</html>