<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test New Loading Mechanism</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        #log {
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Test New Loading Mechanism</h1>
    <div id="status"></div>
    <div id="log"></div>
    
    <script>
        const log = (msg, type = 'info') => {
            const status = document.getElementById('status');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.textContent = msg;
            status.appendChild(div);
            
            const logDiv = document.getElementById('log');
            logDiv.textContent += `[${new Date().toISOString()}] ${msg}\n`;
        };
        
        // Test loading sequence
        log('Starting test of new loading mechanism...');
        
        // Check if dependencies are defined
        setTimeout(() => {
            log('Checking dependencies after 1 second:');
            log(`marked: ${typeof marked !== 'undefined' ? 'loaded' : 'not loaded'}`, 
                typeof marked !== 'undefined' ? 'success' : 'error');
            log(`hljs: ${typeof hljs !== 'undefined' ? 'loaded' : 'not loaded'}`, 
                typeof hljs !== 'undefined' ? 'success' : 'error');
            log(`markedHighlight: ${typeof markedHighlight !== 'undefined' ? 'loaded' : 'not loaded'}`, 
                typeof markedHighlight !== 'undefined' ? 'success' : 'error');
            
            // Check localStorage
            log('\nChecking localStorage:');
            const keys = ['training-docs-theme', 'mdv-theme', 'mdv-selected-theme'];
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    log(`${key}: ${value}`, 'info');
                } else {
                    log(`${key}: empty`, 'success');
                }
            });
        }, 1000);
        
        // Load test viewer
        setTimeout(() => {
            log('\nTesting viewer pages:');
            
            // Test docs-viewer.html
            fetch('docs-viewer.html')
                .then(response => response.text())
                .then(html => {
                    if (html.includes('dependencyLoaded')) {
                        log('docs-viewer.html has new loading mechanism', 'success');
                    } else {
                        log('docs-viewer.html missing new loading mechanism', 'error');
                    }
                });
            
            // Test docs/index.html
            fetch('docs/index.html')
                .then(response => response.text())
                .then(html => {
                    if (html.includes('dependencyLoaded')) {
                        log('docs/index.html has new loading mechanism', 'success');
                    } else {
                        log('docs/index.html missing new loading mechanism', 'error');
                    }
                });
        }, 2000);
    </script>
    
    <!-- Load dependencies to test -->
    <script src="https://cdn.jsdelivr.net/npm/marked@14.1.2/lib/marked.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-highlight@2.1.4/lib/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.10.0/lib/highlight.min.js"></script>
</body>
</html>